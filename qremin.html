<!DOCTYPE html><html><head><title>QR Slideshow</title><script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script><style>body{max-width:800px;margin:20px auto;font-family:sans-serif;padding:20px;text-align:center}#slideContainer{position:relative;width:300px;height:350px;margin:20px auto}.qr-slide{display:none;position:absolute;width:100%;left:0;top:0}.qr-slide.active{display:block}.qr-label{margin-top:10px;font-weight:bold}.controls{margin:20px 0}button{padding:10px 20px;margin:5px;cursor:pointer}#counter{margin:10px 0;font-size:1.2em}.marker{color:#f44;font-weight:bold}</style></head><body><input type="file" id="f"/><button onclick="g()" id="gB">Gen QR</button><div id="sC"></div><div id="st"></div><div class="controls"><button onclick="p()">Prev</button><button onclick="t()" id="ppB">Pause</button><button onclick="n()">Next</button></div><div id="c"></div><pre id="d"></pre><script>const CS=460,SI=1600,TC=5,SM="###QRSTART###",EM="###QREND###",DM="#DATA#";let cs=0,si=null,ci=null,pl=false,ts=0,tc=TC,dl=[],fc=null;function l(m){dl.push(m);d.textContent=dl.join('\n')}const f=document.getElementById('f'),gB=document.getElementById('gB'),st=document.getElementById('st'),sC=document.getElementById('sC'),c=document.getElementById('c'),ppB=document.getElementById('ppB'),d=document.getElementById('d');function ss(m){st.textContent=m}function uc(){c.textContent=`Slide ${cs+1} of ${ts}`}function sh(i){document.querySelectorAll('.qr-slide').forEach(s=>s.classList.remove('active'));document.querySelectorAll('.qr-slide')[i].classList.add('active');cs=i;uc()}function n(){cs=(cs+1)%ts;sh(cs)}function p(){cs=(cs-1+ts)%ts;sh(cs)}function sS(){if(!pl){pl=true;ppB.textContent='Pause';si=setInterval(n,SI)}}function nc(){currentCountDown=(currentCountDown-1)%tc;if(currentCountDown==0){clearInterval(ci);sh(0);l(`StartSlides show: ${tc}`);sS()}else ss(`countdown ${currentCountDown}`)}function sCdn(){ci=setInterval(nc,SI)}function ps(){if(pl){pl=false;ppB.textContent='Play';clearInterval(si)}}function t(){pl?ps():sS()}function ch(s,z){let a=[];for(let i=0;i<s.length;i+=z)a.push(s.slice(i,i+z));return a}function cQ(t,lab){return new Promise(r=>{let d=document.createElement('div');d.className='qr-slide';new QRCode(d,{text:t,width:256,height:256,correctLevel:QRCode.CorrectLevel.L});let le=document.createElement('div');le.className='qr-label';le.textContent=lab;d.appendChild(le);sC.appendChild(d);r()})}f.addEventListener('change',e=>{const file=e.target.files[0];if(!file){gB.disabled=true;return}const r=new FileReader();r.onload=e=>{fc=e.target.result;gB.disabled=false;ss('File loaded!')};r.onerror=()=>{ss('Error reading file');gB.disabled=true};r.readAsArrayBuffer(file)});async function g(){if(!fc){ss('Select file first');return}dl=[];ps();sC.innerHTML='';cs=0;ss("Generating");const b=new Uint8Array(fc);l(`File size: ${b.length} bytes`);const b64=btoa(String.fromCharCode.apply(null,b));l(`B64 len: ${b64.length}`);ss(`Read ${b64.length}`);const chs=ch(b64,CS);ss(`Chunks: ${chs.length}`);l(`Chunks: ${chs.length}`);chs.forEach((ch,i)=>{ss(`Chunk ${i+1}: ${ch.length}`);l(`Chunk ${i+1}: ${ch.length}`)});const tcs=chs.reduce((s,ch)=>s+ch.length,0);l(`Total chunk: ${tcs}`);l(`Match: ${tcs===b64.length}`);const samp=chs[0];const dec=atob(samp);l(`Sample:\nOrig len: ${samp.length}\nDecoded: ${dec.length}`);const fn=f.files[0].name+".b64";const sd=JSON.stringify({marker:SM,frames:chs.length,file:fn,size:b.length});l(`Start len: ${sd.length}`);await cQ(sd,'Start Frame');for(let i=0;i<chs.length;i++){const cd=JSON.stringify({marker:DM,current:i+1,frames:chs.length,contents:chs[i]});await cQ(cd,`Frame ${i+1}/${chs.length}`);ss(`Gen frame ${i+1}/${chs.length}`)}const ed=JSON.stringify({marker:EM,command:`decode base64 "${fn}"`});l(`End len: ${ed.length}`);await cQ(ed,'End Frame');ts=chs.length+2;ss(`Generated ${ts} QR codes`);const exp=Math.floor((tcs*3)/4);l(`Expected decoded: ${exp}\nOrig size: ${b.length}\nMatch: ${exp===b.length}`);currentCountDown=TC;l(`StartCount: ${tc}`);sCdn()}</script></body></html>
