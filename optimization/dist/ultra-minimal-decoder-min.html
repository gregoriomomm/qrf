<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Ultra Minimal QR Decoder v3.0</title><style>body{font-family:Arial,sans-serif;padding:10px;max-width:600px;margin:0 auto;background:#f9fafb}.box{border:1px solid #ccc;padding:15px;margin:10px 0;border-radius:6px;background:#fff}.progress,textarea{width:100%;margin:8px 0}textarea{height:80px;border:1px solid #ddd;border-radius:4px;padding:8px}button{background:#2563eb;color:#fff;border:none;padding:10px 18px;margin:4px;border-radius:4px;cursor:pointer;font-weight:600}.bar,.progress{border-radius:6px}button:hover{background:#1d4ed8}button:disabled{background:#94a3b8;cursor:not-allowed}.success{background:#dcfce7;color:#16a34a;border-color:#22c55e}.error{background:#fef2f2;color:#dc2626;border-color:#ef4444}.warning{background:#fffbeb;color:#d97706;border-color:#f59e0b}.progress{height:12px;background:#e5e7eb;overflow:hidden}.bar{height:100%;background:#2563eb;width:0%;transition:width .3s}.file-info{display:none;background:#f0f9ff;border:1px solid #0ea5e9;margin:10px 0;padding:12px;border-radius:6px}.chunk-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(20px,1fr));gap:2px;margin:10px 0}.chunk{width:20px;height:20px;border-radius:2px;background:#e5e7eb}.chunk.received{background:#22c55e}.stats{font-size:12px;color:#6b7280;margin-top:8px}</style></head><body><h2>üì± Ultra Minimal QR Decoder v3.0</h2><p><small>Compatible with fountain coding and v3.0 encoder format</small></p><div class="box"><b>üìã Scan QR ‚Üí Paste Here ‚Üí Click Add:</b><br><textarea id="qr" placeholder="Paste QR text here..."></textarea> <button onclick="add()">Add QR</button> <button onclick="clear()">Clear</button> <button onclick="reset()">Reset All</button></div><div id="msg" class="box">Ready! Use phone camera/QR app ‚Üí scan ‚Üí paste ‚Üí add</div><div class="progress"><div id="bar" class="bar"></div></div><div id="info" class="file-info"><div id="file-details"></div><div class="chunk-grid" id="chunks"></div><div class="stats" id="stats"></div></div><div id="down" style="display:none"><button onclick="download()" style="background:#16a34a;font-size:18px;padding:15px 30px">üì• Download File</button></div><script>let files={},curr="",chunks={},sourceChunks={},codedPackets=[],total=0,got=0,fileData=null,metadata=null;function add(){const t=document.getElementById("qr").value.trim();if(t)try{if(t.startsWith("M:")){const e=t.split(":");if(e.length<17)return void msg("‚ö†Ô∏è Invalid metadata format","error");curr=decodeURIComponent(e[2]);const n=parseInt(e[4]);total=parseInt(e[5]);const o=parseInt(e[6]);metadata={fileName:curr,fileSize:n,chunksCount:total,totalPackets:o,chunkSize:parseInt(e[10]),redundancy:parseInt(e[11])},chunks={},sourceChunks={},codedPackets=[],got=0,fileData=null,files[curr]={name:curr,size:n,total:total,chunks:{},sourceChunks:{}},document.getElementById("file-details").innerHTML=`<b>üìÑ ${curr}</b><br>Size: ${fmt(n)}<br>Chunks: 0/${total}<br>Packets: 0/${o}`,document.getElementById("info").style.display="block",initChunkGrid(total),msg(`üìÅ File: ${curr} (${total} chunks)`,"success")}else if(t.startsWith("D:")&&curr){const e=t.split(":");if(e.length<7)return void msg("‚ö†Ô∏è Invalid data format","error");const n=parseInt(e[5]),o=e.slice(6).join(":");if(1===n){const t=parseInt(o.split(":")[0]),e=o.split(":")[1];sourceChunks[t]||(sourceChunks[t]=base64ToBytes(e),got++,updateChunkGrid(t),msg(`‚úÖ Chunk ${t+1}/${total} (${got}/${total})`,got===total?"success":"warning"))}else if(2===n){const t=o.split("|");for(const e of t){const[t,n]=e.split(":"),o=parseInt(t);sourceChunks[o]||(sourceChunks[o]=base64ToBytes(n),got++,updateChunkGrid(o))}msg(`‚úÖ Multi-chunk packet: ${got}/${total}`,got===total?"success":"warning")}else{const t=e[6].split(",").map((t=>parseInt(t))),o=base64ToBytes(e[7]);codedPackets.push({sourceIndices:t,xorData:o}),msg(`üì¶ Fountain packet (degree ${n}): ${codedPackets.length} stored`,"warning")}if(got<total&&fountainDecode(),got===total){const t=new Uint8Array(metadata.fileSize);let e=0;for(let n=0;n<total;n++)if(sourceChunks[n]){const o=sourceChunks[n],s=Math.min(o.length,metadata.fileSize-e);t.set(o.slice(0,s),e),e+=s}fileData=t,document.getElementById("down").style.display="block",msg(`üéâ File complete! ${got}/${total} chunks recovered`,"success")}updateStats()}else msg("‚ö†Ô∏è Unknown format or no active file","error");document.getElementById("qr").value="",document.getElementById("bar").style.width=got/total*100+"%"}catch(t){msg("‚ùå Error: "+t.message,"error"),console.error(t)}else msg("‚ö†Ô∏è Paste QR data first","error")}function fountainDecode(){let t=!0;for(;t&&got<total;){t=!1;for(let e=codedPackets.length-1;e>=0;e--){const n=codedPackets[e],o=n.sourceIndices.filter((t=>!sourceChunks[t]));if(0!==o.length){if(1===o.length){const s=o[0],a=new Uint8Array(n.xorData);for(const t of n.sourceIndices)t!==s&&sourceChunks[t]&&xorArrays(a,sourceChunks[t]);sourceChunks[s]=a,got++,updateChunkGrid(s),codedPackets.splice(e,1),t=!0}}else codedPackets.splice(e,1)}}}function xorArrays(t,e){for(let n=0;n<Math.min(t.length,e.length);n++)t[n]^=e[n]}function base64ToBytes(t){const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}function initChunkGrid(t){const e=document.getElementById("chunks");e.innerHTML="";for(let n=0;n<t;n++){const t=document.createElement("div");t.className="chunk",t.id="chunk-"+n,t.title="Chunk "+(n+1),e.appendChild(t)}}function updateChunkGrid(t){const e=document.getElementById("chunk-"+t);e&&e.classList.add("received")}function updateStats(){document.getElementById("stats").innerHTML=`Recovered: ${got}/${total} chunks | Fountain packets: ${codedPackets.length} | Recovery rate: ${(got/total*100).toFixed(1)}%`}function clear(){document.getElementById("qr").value="",msg("Cleared input","success")}function reset(){files={},curr="",chunks={},sourceChunks={},codedPackets=[],total=0,got=0,fileData=null,metadata=null,document.getElementById("info").style.display="none",document.getElementById("down").style.display="none",document.getElementById("bar").style.width="0%",msg("Reset complete - ready for new file","success")}function download(){if(!fileData||!metadata)return void msg("‚ùå No file to download","error");const t=new Blob([fileData]),e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download=metadata.fileName||"decoded-file.bin",n.click(),URL.revokeObjectURL(e),msg("üì• Download started","success")}function msg(t,e){const n=document.getElementById("msg");n.textContent=t,n.className="box "+(e||"")}function fmt(t){return t<1024?t+" B":t<1048576?Math.round(t/1024)+" KB":Math.round(t/1048576)+" MB"}</script></body></html>