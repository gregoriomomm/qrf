<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Ultra Minimal QR Decoder v3.0</title><style>body{font-family:Arial,sans-serif;padding:10px;max-width:600px;margin:0 auto;background:#f9fafb}.box{border:1px solid #ccc;padding:15px;margin:10px 0;border-radius:6px;background:#fff}.progress,textarea{width:100%;margin:8px 0}textarea{height:80px;border:1px solid #ddd;border-radius:4px;padding:8px}button{background:#2563eb;color:#fff;border:none;padding:10px 18px;margin:4px;border-radius:4px;cursor:pointer;font-weight:600}.bar,.progress{border-radius:6px}button:hover{background:#1d4ed8}button:disabled{background:#94a3b8;cursor:not-allowed}.success{background:#dcfce7;color:#16a34a;border-color:#22c55e}.error{background:#fef2f2;color:#dc2626;border-color:#ef4444}.warning{background:#fffbeb;color:#d97706;border-color:#f59e0b}.progress{height:12px;background:#e5e7eb;overflow:hidden}.bar{height:100%;background:#2563eb;width:0%;transition:width .3s}.file-info{display:none;background:#f0f9ff;border:1px solid #0ea5e9;margin:10px 0;padding:12px;border-radius:6px}.chunk-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(20px,1fr));gap:2px;margin:10px 0}.chunk{width:20px;height:20px;border-radius:2px;background:#e5e7eb}.chunk.received{background:#22c55e}.stats{font-size:12px;color:#6b7280;margin-top:8px}</style></head><body><h2>üì± Ultra Minimal QR Decoder v3.0</h2><p><small>Compatible with fountain coding and v3.0 encoder format</small></p><div class="box"><b>üìã Scan QR ‚Üí Paste Here ‚Üí Click Add:</b><br><textarea id="qr" placeholder="Paste QR text here..."></textarea> <button onclick="add()">Add QR</button> <button onclick="clear()">Clear</button> <button onclick="reset()">Reset All</button></div><div id="msg" class="box">Ready! Use phone camera/QR app ‚Üí scan ‚Üí paste ‚Üí add</div><div class="progress"><div id="bar" class="bar"></div></div><div id="info" class="file-info"><div id="file-details"></div><div class="chunk-grid" id="chunks"></div><div class="stats" id="stats"></div></div><div id="down" style="display:none"><button onclick="download()" style="background:#16a34a;font-size:18px;padding:15px 30px">üì• Download File</button></div><script>let files={},curr="",chunks={},sourceChunks={},codedPackets=[],total=0,got=0,fileData=null,metadata=null;function add(){const e=document.getElementById("qr").value.trim();if(e)try{if(e.startsWith("M:")){const t=e.split(":");if(t.length<17)return void msg("‚ö†Ô∏è Invalid metadata format","error");curr=decodeURIComponent(t[2]);const n=parseInt(t[4]);total=parseInt(t[5]);const o=parseInt(t[6]);metadata={fileName:curr,fileSize:n,chunksCount:total,totalPackets:o,chunkSize:parseInt(t[10]),redundancy:parseInt(t[11]),metaChecksum:t[13]||"",fileChecksum:t[14]||""},chunks={},sourceChunks={},codedPackets=[],got=0,fileData=null,files[curr]={name:curr,size:n,total:total,chunks:{},sourceChunks:{}},document.getElementById("file-details").innerHTML=`<b>üìÑ ${curr}</b><br>Size: ${fmt(n)}<br>Chunks: 0/${total}<br>Packets: 0/${o}`,document.getElementById("info").style.display="block",initChunkGrid(total),msg(`üìÅ File: ${curr} (${total} chunks)`,"success")}else if(e.startsWith("D:")&&curr){const t=e.split(":");if(t.length<7)return void msg("‚ö†Ô∏è Invalid data format","error");const n=parseInt(t[5]),o=t.slice(6).join(":");if(1===n){const e=parseInt(o.split(":")[0]),t=o.split(":")[1];sourceChunks[e]||(sourceChunks[e]=base64ToBytes(t),got++,updateChunkGrid(e),msg(`‚úÖ Chunk ${e+1}/${total} (${got}/${total})`,got===total?"success":"warning"))}else if(2===n){const e=o.split("|");for(const t of e){const[e,n]=t.split(":"),o=parseInt(e);sourceChunks[o]||(sourceChunks[o]=base64ToBytes(n),got++,updateChunkGrid(o))}msg(`‚úÖ Multi-chunk packet: ${got}/${total}`,got===total?"success":"warning")}else{const e=t[6].split(",").map((e=>parseInt(e))),o=base64ToBytes(t[7]);codedPackets.push({sourceIndices:e,xorData:o}),msg(`üì¶ Fountain packet (degree ${n}): ${codedPackets.length} stored`,"warning")}if(got<total&&fountainDecode(),got===total){const e=new Uint8Array(metadata.fileSize);let t=0;for(let n=0;n<total;n++)if(sourceChunks[n]){const o=sourceChunks[n],s=Math.min(o.length,metadata.fileSize-t);e.set(o.slice(0,s),t),t+=s}let n=!0;if(metadata.fileChecksum){const t=calculateFNV1aChecksum(e);t===metadata.fileChecksum?(console.log(`‚úÖ File integrity verified: ${t}`),n=!0):(console.error(`‚ùå Checksum FAILED! Expected: ${metadata.fileChecksum}, Got: ${t}`),n=!1)}n?(fileData=e,document.getElementById("down").style.display="block",msg(`üéâ File complete and verified! ${got}/${total} chunks`,"success")):msg("üö´ File complete but CORRUPTED - checksum failed","error")}updateStats()}else msg("‚ö†Ô∏è Unknown format or no active file","error");document.getElementById("qr").value="",document.getElementById("bar").style.width=got/total*100+"%"}catch(e){msg("‚ùå Error: "+e.message,"error"),console.error(e)}else msg("‚ö†Ô∏è Paste QR data first","error")}function fountainDecode(){let e=!0;for(;e&&got<total;){e=!1;for(let t=codedPackets.length-1;t>=0;t--){const n=codedPackets[t],o=n.sourceIndices.filter((e=>!sourceChunks[e]));if(0!==o.length){if(1===o.length){const s=o[0],a=new Uint8Array(n.xorData);for(const e of n.sourceIndices)e!==s&&sourceChunks[e]&&xorArrays(a,sourceChunks[e]);sourceChunks[s]=a,got++,updateChunkGrid(s),codedPackets.splice(t,1),e=!0}}else codedPackets.splice(t,1)}}}function xorArrays(e,t){for(let n=0;n<Math.min(e.length,t.length);n++)e[n]^=t[n]}function base64ToBytes(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function initChunkGrid(e){const t=document.getElementById("chunks");t.innerHTML="";for(let n=0;n<e;n++){const e=document.createElement("div");e.className="chunk",e.id="chunk-"+n,e.title="Chunk "+(n+1),t.appendChild(e)}}function updateChunkGrid(e){const t=document.getElementById("chunk-"+e);t&&t.classList.add("received")}function updateStats(){document.getElementById("stats").innerHTML=`Recovered: ${got}/${total} chunks | Fountain packets: ${codedPackets.length} | Recovery rate: ${(got/total*100).toFixed(1)}%`}function clear(){document.getElementById("qr").value="",msg("Cleared input","success")}function reset(){files={},curr="",chunks={},sourceChunks={},codedPackets=[],total=0,got=0,fileData=null,metadata=null,document.getElementById("info").style.display="none",document.getElementById("down").style.display="none",document.getElementById("bar").style.width="0%",msg("Reset complete - ready for new file","success")}function download(){if(!fileData||!metadata)return void msg("‚ùå No file to download","error");const e=new Blob([fileData]),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=metadata.fileName||"decoded-file.bin",n.click(),URL.revokeObjectURL(t),msg("üì• Download started","success")}function msg(e,t){const n=document.getElementById("msg");n.textContent=e,n.className="box "+(t||"")}function fmt(e){return e<1024?e+" B":e<1048576?Math.round(e/1024)+" KB":Math.round(e/1048576)+" MB"}function calculateFNV1aChecksum(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e[n],t=Math.imul(t,16777619);return(t>>>0).toString(36).substring(0,8)}</script></body></html>